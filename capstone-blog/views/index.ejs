<%- include('partials/header', { pageTitle: 'My Blog' }) %>
<section class="compose">
  <h1>Compose a new post</h1>
  <% if (typeof error === 'string' && error.length) { %>
    <div class="alert alert-error"><%= error %></div>
  <% } %>
  <form action="/posts" method="POST" class="form">
    <div class="form-group">
      <label for="title">Title</label>
      <input
        type="text"
        id="title"
        name="title"
        value="<%= formData.title || '' %>"
        required
        placeholder="Enter a catchy title"
      />
    </div>
    <div class="form-group">
      <label for="content">Content</label>
      <textarea
        id="content"
        name="content"
        rows="6"
        required
        placeholder="Share your thoughts..."
      ><%= formData.content || '' %></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Publish</button>
  </form>
</section>

<section class="posts">
  <div class="section-header">
    <h2>Recent posts</h2>
  </div>
  <% if (!posts.length) { %>
    <p class="empty-state">No posts yet. Start writing your first story!</p>
  <% } else { %>
    <div class="posts-grid">
      <% posts.forEach((post) => { %>
        <article class="post-card">
          <div class="post-card-header">
            <h3><a href="/posts/<%= post.id %>"><%= post.title %></a></h3>
            <span class="timestamp">Updated <%= post.updatedAt.toLocaleString() %></span>
          </div>
          <p class="excerpt"><%= post.content.length > 180 ? post.content.slice(0, 180) + 'â€¦' : post.content %></p>
          <div class="post-card-actions">
            <a href="/posts/<%= post.id %>" class="btn btn-secondary">Read</a>
            <a href="/posts/<%= post.id %>/edit" class="btn btn-secondary">Edit</a>
            <form action="/posts/<%= post.id %>?_method=DELETE" method="POST" onsubmit="return confirm('Delete this post?');">
              <button type="submit" class="btn btn-danger">Delete</button>
            </form>
          </div>
        </article>
      <% }) %>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
